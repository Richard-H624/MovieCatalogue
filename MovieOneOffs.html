<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>One-Off Movies Watched 2025</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div id="greeting"></div>
  <script src="script.js"></script>
  <button id="back-to-home" class="btn btn-secondary mb-3" onclick="window.location.href='index.html'">â¬… Back to Homepage</button>
  <div class="modal fade" id="movieModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img id="modalPoster" class="img-fluid mb-3" />
          <p id="modalSummary"></p>
          <p id="modalBudget"></p>
          <p id="modalEarnings"></p>
          <div class="d-flex justify-content-between mt-3">
            <button id="prev-movie" class="btn btn-secondary">Previous Movie</button>
            <button id="next-movie" class="btn btn-secondary">Next Movie</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container py-4">
    <h1 class="mb-4 text-center">One-Off Movies Watched 2025</h1>
    <div class="row" id="oneoff-grid"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let allMovies = [];

    fetch('/api/oneoffs')
      .then(res => res.json())
      .then(movies => {
        allMovies = movies;
        const grid = document.getElementById('oneoff-grid');
        grid.innerHTML = '';
        movies.forEach((movie, idx) => {
          const col = document.createElement('div');
          col.className = 'col-md-4 mb-4';
          col.innerHTML = `
            <div class="card h-100 shadow-sm" style="cursor:pointer" data-movie="${idx}">
              <img src="${movie.poster}" class="card-img-top" alt="${movie.title}">
              <div class="card-body">
                <h5 class="card-title">${movie.title} (${movie.year})</h5>
                <p class="card-text">${movie.summary}</p>
                <span class="badge bg-primary">Rating: ${movie.rating}</span>
              </div>
            </div>
          `;
          col.querySelector('.card').addEventListener('click', function() {
            openModal(idx);
          });
          grid.appendChild(col);
        });
      });

    function openModal(idx) {
      window.currentMovieIndex = idx;
      const movie = allMovies[idx];
      document.getElementById('modalTitle').textContent = movie.title + ' (' + movie.year + ')';
      document.getElementById('modalPoster').src = movie.poster;
      document.getElementById('modalSummary').innerHTML = movie.summary;
      document.getElementById('modalBudget').innerHTML = movie.budget ? `<b>Budget:</b> ${movie.budget}` : '';
      document.getElementById('modalEarnings').innerHTML = movie.earnings ? `<b>Earnings:</b> ${movie.earnings}` : '';
      const modal = new bootstrap.Modal(document.getElementById('movieModal'));
      modal.show();

      document.getElementById('prev-movie').onclick = function() {
        if (idx > 0) openModal(idx - 1);
        else openModal(allMovies.length - 1); // wrap to last
      };
      document.getElementById('next-movie').onclick = function() {
        if (idx < allMovies.length - 1) openModal(idx + 1);
        else openModal(0); // wrap to first
      };
    }
  </script>
</body>
</html>